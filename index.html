<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>De Horst - Indoor Routezoeker Mazemap</title>
  <script>
    // Forceer altijd HTTPS, behalve bij lokaal openen (file://)
    if (location.protocol === 'http:') {
      location.href = location.href.replace('http:', 'https:');
    } else if (location.protocol === 'file:') {
      alert('Open deze site via https:// op een webserver voor volledige functionaliteit.');
    }
  </script>
  <style>
    body { background: #222244; color: white; font-family: Arial, sans-serif; }
    #container { max-width: 1000px; margin: 0 auto; padding: 20px; }
    #mapframe { width: 100%; height: 500px; border: 2px solid #44DD44; }
    #widgets { display: flex; gap: 20px; margin-top: 20px; }
    #kompass, #navigatie { flex: 1; background: #185FB6; color: white; padding: 16px; border-radius: 12px; }
    #userform { background: #185FB6; color: white; padding: 16px; border-radius: 12px; max-width: 400px; margin: 40px auto; }
    #userform label { display: block; margin-top: 10px; }
    #userform input, #userform select { width: 100%; padding: 6px; margin-top: 4px; }
    #userform button { margin-top: 16px; background: #44DD44; color: white; font-size: 1.1em; border: none; padding: 8px 16px; border-radius: 6px; }
    #userinfo { margin-bottom: 20px; background: #185FB6; padding: 10px; border-radius: 8px; }
    #routebeschrijving { width:100%; min-height:80px; }
    .hint { color: #FFD700; font-size: 0.95em; margin-bottom: 8px; }
    #localWarning { display:none; background:#FFD700; color:#222244; padding:12px; text-align:center; font-weight:bold; }
  </style>
</head>
<body>
  <div id="localWarning">
    Je hebt deze site lokaal geopend. Klik hier om de online versie te openen:<br>
    <a href="https://utwente.nl/website.html" style="color:#185FB6; text-decoration:underline; font-size:1.1em;">https://utwente.nl/website.html</a>
  </div>
  <div id="container">
    <h2>De Horst - Indoor Routezoeker</h2>
    <div id="userform" style="display:none;">
      <h3>Vul je persoonlijke gegevens in</h3>
      <form id="form">
        <label>Naam: <input type="text" name="naam" required></label>
        <label>Leeftijd: <input type="number" name="leeftijd" min="0" required></label>
        <label>Geslacht:
          <select name="geslacht" required>
            <option value="">Kies...</option>
            <option value="Man">Man</option>
            <option value="Vrouw">Vrouw</option>
            <option value="Anders">Anders</option>
          </select>
        </label>
        <label>Studie: <input type="text" name="studie" required></label>
        <label>Nationaliteit: <input type="text" name="nationaliteit" required></label>
        <label>Email: <input type="email" name="email" required></label>
        <button type="submit">Opslaan</button>
      </form>
    </div>
    <div id="maincontent" style="display:none;">
      <div id="userinfo" style="display:none;"></div>
      <iframe id="mapframe"
        src="https://use.mazemap.com/#v=1&campusid=171"
        allowfullscreen
        frameborder="0"></iframe>
      <div id="widgets">
        <div id="kompass">
          <h3>SmartKompass koppelen</h3>
          <button onclick="koppelKompass()">Zoek en koppel via Bluetooth</button>
          <div id="kompassStatus">Geen SmartKompass verbonden.</div>
          <div class="hint">Bluetooth werkt alleen in Chrome en via HTTPS.</div>
        </div>
        <div id="navigatie">
          <h3>Navigatiestappen</h3>
          <div class="hint">Mazemap toont locatie en route. Kopieer de routebeschrijving uit Mazemap en plak deze hieronder.</div>
          <textarea id="routebeschrijving" placeholder="Kopieer hier de routebeschrijving uit Mazemap of vul handmatig in..."></textarea>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Persoonlijke gegevens opslaan en laden
    function showUserForm() {
      document.getElementById('userform').style.display = 'block';
      document.getElementById('maincontent').style.display = 'none';
      document.getElementById('userinfo').style.display = 'none';
    }
    function showUserInfo(data) {
      let info = `<b>Naam:</b> ${data.naam}<br>
                  <b>Leeftijd:</b> ${data.leeftijd}<br>
                  <b>Geslacht:</b> ${data.geslacht}<br>
                  <b>Studie:</b> ${data.studie}<br>
                  <b>Nationaliteit:</b> ${data.nationaliteit}<br>
                  <b>Email:</b> ${data.email}`;
      document.getElementById('userinfo').innerHTML = info + '<br><button onclick="editUser()">Wijzig gegevens</button>';
      document.getElementById('userinfo').style.display = 'block';
      document.getElementById('userform').style.display = 'none';
      document.getElementById('maincontent').style.display = 'block';
    }
    function editUser() {
      showUserForm();
    }
    window.onload = function() {
      let user = localStorage.getItem('horst_user');
      if (!user) {
        showUserForm();
      } else {
        showUserInfo(JSON.parse(user));
      }
      document.getElementById('form').onsubmit = function(e) {
        e.preventDefault();
        let data = {};
        Array.from(this.elements).forEach(el => {
          if (el.name) data[el.name] = el.value;
        });
        localStorage.setItem('horst_user', JSON.stringify(data));
        showUserInfo(data);
      };
      // Toon link bij lokaal openen
      if (location.protocol === 'file:') {
        document.getElementById('localWarning').style.display = 'block';
      }
    };

    // Bluetooth scan voor SmartKompass (simulatie)
    function koppelKompass() {
      if (!navigator.bluetooth) {
        document.getElementById('kompassStatus').textContent = 'Bluetooth niet ondersteund in deze browser.';
        return;
      }
      document.getElementById('kompassStatus').textContent = 'Zoeken naar SmartKompass...';
      navigator.bluetooth.requestDevice({
        acceptAllDevices: true,
        optionalServices: []
      })
      .then(device => {
        document.getElementById('kompassStatus').textContent = 'Verbonden met: ' + device.name;
      })
      .catch(error => {
        document.getElementById('kompassStatus').textContent = 'Bluetooth-verbinding mislukt: ' + error;
      });
    }
  </script>
</body>
</html>